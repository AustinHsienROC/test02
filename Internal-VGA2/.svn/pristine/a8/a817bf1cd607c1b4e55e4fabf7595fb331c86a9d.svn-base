#ifdef _WIN32
  #include "stdafx.h"
#else // K2 platform
  #include "GlobalTypes.h"
#endif
#include "WarningDecision.h"

//******************************************************************************
// S T A T I C   F U N C T I O N   P R O T O T Y P E S
//******************************************************************************

//******************************************************************************
// M A C R O   D E F I N I T I O N S
//******************************************************************************
WarningDecision* WarningDecision::instance = NULL;

//******************************************************************************
// F U N C T I O N   B O D Y S
//******************************************************************************

/**
* @brief	 Warning Decision
* @param[in]  CTACandidateL		Input all CandidateL at current frame
* @param[in]  MaxCandNumL		CandidateL numbers
* @param[out] isAlarm		    The result([0:No alarm / 1:Right Alrm  /2:LeftAlarm / 3: Both side alarm])
*/
void WarningDecision::bawl( CandidateRec CTACandidateL[], CandidateRec CTACandidateR[], INT32 MaxCandNumL, INT32 MaxCandNumR, UCHAR &isAlarm )
{
    isAlarm = 0x00;
    /// Voice Alarm
    for ( INT16 i1 = 0 ; i1 < MaxCandNumL ; ++i1) 
    {
        if( FALSE == CTACandidateL[i1].isValid ) continue;
        if( 0 >= CTACandidateL[i1].countDown )
        {
            isAlarm |= 0x02;
            break;
        }
    }

    for ( INT16 i1 = 0 ; i1 < MaxCandNumR ; ++i1) 
    {
        if( FALSE == CTACandidateR[i1].isValid ) continue;
        if( 0 >= CTACandidateR[i1].countDown )
        {
            isAlarm |= 0x01;
            break;
        }
    }
}
/**
* @brief	 [NightMode]Warning Decision
* @param[in] lamp		Input lamp at current frame
* @return	 isWarninig Event Trigger
*/
void WarningDecision::bowwow_Night( HeadLight lampL[], HeadLight lampR[], INT16 maxLampNumL, INT16 maxLampNumR, UCHAR &AlarmState )
{
    AlarmState = 0x00;
    /// Voice Alarm
    for ( INT16 i1 = 0 ; i1 < maxLampNumL ; ++i1) // CTACandidate Total Num
    {
        if( FALSE == lampL[i1].isValid ) continue;
        if( 0 >= lampL[i1].countDown )
        {
            AlarmState |= 0x02;
            break;
        }
    }
    for ( INT16 i1 = 0 ; i1 < maxLampNumR ; ++i1) 
    {
        if( FALSE == lampR[i1].isValid ) continue;
        if( 0 >= lampR[i1].countDown )
        {
            AlarmState |= 0x01;
            break;
        }
    }

}
void WarningDecision::WarningDecisionPatch()
{
    return;
}
WarningDecision* WarningDecision::getInstance()
{
    if(!instance)
        instance = new WarningDecision;
    return instance;
}

WarningDecision::WarningDecision(void)
{
}


WarningDecision::~WarningDecision(void)
{
}
